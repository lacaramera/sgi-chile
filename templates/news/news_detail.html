{% extends "base.html" %}
{% load static %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}

<div class="max-w-3xl mx-auto space-y-6">

  <div class="bg-white rounded-3xl shadow-sm p-6 border border-gray-100">
    <div class="flex items-center gap-2 mb-3">
      <span class="text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-700">
        {% if post.scope == "chile" %}Chile{% else %}General{% endif %}
      </span>
      {% if post.is_pinned %}
        <span class="text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-800">Destacada</span>
      {% endif %}
      <span class="text-xs text-gray-500 ml-auto">
        {{ post.published_at|date:"d M Y" }}
      </span>
    </div>

    <h1 class="text-2xl font-extrabold text-slate-900 leading-tight">
      {{ post.title }}
    </h1>

    {% if post.image %}
      <button type="button"
              class="mt-5 w-full"
              data-modal-image="{{ post.image.url }}"
              data-modal-title="{{ post.title|escape }}">
        <img src="{{ post.image.url }}"
             alt="Imagen noticia"
             class="w-full max-h-[420px] object-cover rounded-2xl hover:opacity-95 transition" />
      </button>
    {% endif %}

    {% if post.summary %}
      <p class="text-base text-slate-700 mt-5 whitespace-pre-line">
        {{ post.summary }}
      </p>
    {% endif %}

    <div class="prose max-w-none mt-5 text-slate-800 whitespace-pre-line">
      {{ post.body }}
    </div>

    {% if post.source_url %}
      <div class="mt-6 pt-4 border-t border-gray-100">
        <div class="text-sm text-gray-600">Fuente oficial:</div>
        <a href="{{ post.source_url }}"
           target="_blank"
           rel="noopener"
           class="text-sky-700 font-semibold hover:underline break-all">
          {{ post.source_url }}
        </a>
      </div>
    {% endif %}

    <div class="mt-6">
      <a href="{% url 'news_list' %}"
         class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border hover:bg-slate-50">
        ← Volver a noticias
      </a>
    </div>
  </div>

</div>

<!-- MODAL IMAGEN (Lightbox) -->
<div id="imgModal" class="fixed inset-0 z-[9999] hidden" aria-hidden="true">
  <div id="imgModalBackdrop" class="absolute inset-0 bg-black/70"></div>

  <div class="relative z-[10000] h-full w-full flex items-center justify-center p-4">
    <div class="relative max-w-5xl w-full">
      <button id="imgModalClose"
              type="button"
              class="absolute -top-3 -right-3 bg-white text-slate-900 rounded-full w-10 h-10 shadow flex items-center justify-center text-xl font-bold hover:opacity-90"
              aria-label="Cerrar">×</button>

      <div id="imgModalTitle" class="text-white text-sm mb-2 opacity-90"></div>

      <img id="imgModalImage"
           src=""
           alt="Imagen en grande"
           class="w-full max-h-[80vh] object-contain rounded-2xl bg-black/20" />
    </div>
  </div>
</div>

<script>
  (function () {
    const modal = document.getElementById("imgModal");
    const backdrop = document.getElementById("imgModalBackdrop");
    const btnClose = document.getElementById("imgModalClose");
    const img = document.getElementById("imgModalImage");
    const title = document.getElementById("imgModalTitle");

    function openModal(src, t) {
      img.src = src;
      title.textContent = t || "";
      modal.classList.remove("hidden");
      modal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    function closeModal() {
      modal.classList.add("hidden");
      modal.setAttribute("aria-hidden", "true");
      img.src = "";
      title.textContent = "";
      document.body.style.overflow = "";
    }

    document.addEventListener("click", function (e) {
      const btn = e.target.closest("[data-modal-image]");
      if (!btn) return;
      e.preventDefault();
      openModal(btn.dataset.modalImage, btn.dataset.modalTitle);
    });

    btnClose.addEventListener("click", closeModal);
    backdrop.addEventListener("click", closeModal);

    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape" && !modal.classList.contains("hidden")) closeModal();
    });
  })();
</script>

{% endblock %}
